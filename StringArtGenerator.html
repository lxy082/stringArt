<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>绕线画生成器</title>
    <link rel="stylesheet" type="text/css" href="css/controls.css">
    <link rel="stylesheet" type="text/css" href="css/styles.css">
</head>
<body>
    <h1>绕线画生成器</h1>
    <div class="generator" id="generator-box">
        <div class="drag-drop" id="drag-drop-box" style="display: none">
            <div class="drag-drop-table">
                <div>松开文件即可加载图片</div>
            </div>
        </div>

        <div class="controls">
            <div class="control-block centered no-top-padding">
                <input type="submit" id="select-btn" value="选择图片">
            </div>

            <div class="control-block no-top-padding">
                <label><b>模式</b>
                    <select id="mode-box">
                        <option value="auto" selected>系统生成（自动）</option>
                        <option value="manual">我来绘制（手动复刻）</option>
                    </select>
                </label>
            </div>

            <div id="controls-box">
                <div id="auto-mode-section">
                    <div class="control-block no-top-padding">
                        <label><b>形状</b>
                            <select id="form-type-box" disabled>
                                <option value="circle" selected>圆形</option>
                                <option value="rect">方形</option>
                                <option value="album">横向矩形</option>
                                <option value="portrait">纵向矩形</option>
                                <option value="image">按图片比例</option>
                            </select>
                        </label>
                    </div>

                    <div class="control-block no-top-padding">
                        <input type="checkbox" id="invert-box" disabled> <label for="invert-box">反转亮度</label>
                    </div>

                    <div class="control-block no-margin no-top-padding">
                        <label><b>对比度</b><br>
                            <input type="range" id="contrast-box" value="0" min="-100" max="100" step="5" disabled>
                        </label>
                        <div class="range-label" id="contrast-value">0</div>

                        <label><b>亮度</b><br>
                            <input type="range" id="brightness-box" value="0" min="-100" max="100" step="5" disabled>
                        </label>
                        <div class="range-label" id="brightness-value">0</div>
                    </div>

                    <div class="control-block no-top-padding">
                        <label><b>钉子布局</b>
                            <select id="nails-mode-box" disabled>
                                <option value="border" selected>沿边缘</option>
                                <option value="grid">网格分布</option>
                                <option value="random">随机分布</option>
                            </select>
                        </label>
                    </div>

                    <div class="control-block no-top-padding">
                        <label><b>钉子数量</b><br>
                            <input type="number" id="nails-count-box" value="250" min="50" max="1000" disabled>
                        </label>
                    </div>

                    <div class="control-block">
                        <label><b>线段数量</b><br>
                            <input type="number" id="lines-count-box" value="100" min="100" max="10000" disabled>
                        </label>
                    </div>

                    <div class="control-block">
                        <label><b>线段透明度</b><br>
                            <input type="range" id="lines-weight-box" value="10" min="1" max="100" disabled>
                        </label>
                        <div class="range-label" id="lines-weight-value">10%</div>
                    </div>

                    <div class="control-block no-margin">
                        <input type="color" id="lines-color-box" value="#000000" disabled> <label for="lines-color-box"><b>线段颜色</b></label>
                    </div>

                    <div class="control-block">
                        <input type="color" id="background-color-box" value="#ffffff" disabled> <label for="background-color-box"><b>背景颜色</b></label>
                    </div>

                    <div class="control-block centered">
                        <input type="submit" id="generate-btn" value="开始生成" disabled>
                        <input type="submit" id="reset-btn" value="重置" disabled>
                        <div id="status-box"></div>
                    </div>

                    <div class="control-block">
                        <div id="info-box"></div>
                    </div>

                    <div id="save-box" style="display: none">
                        <hr>
                        <div class="control-block no-top-padding">
                            <label><b>保存格式</b>
                                <select id="save-type-box">
                                    <option value="png">png</option>
                                    <option value="svg">svg</option>
                                    <option value="stringart">stringart</option>
                                </select>
                            </label>
                        </div>

                        <div class="control-block no-top-padding centered">
                            <input type="submit" id="save-btn" value="保存文件">
                        </div>

                        <div class="control-block no-top-padding">
                            <label><b>记录名称</b><br>
                                <input type="text" id="record-name-box" placeholder="例如：我的第1幅">
                            </label>
                        </div>
                        <div class="control-block no-top-padding centered">
                            <input type="submit" id="save-record-btn" value="保存本次绕线画到数据库">
                        </div>

                        <div class="control-block no-top-padding">
                            <hr>
                            <div><b>GIF 录制</b></div>
                        </div>
                        <div class="control-block no-top-padding centered">
                            <input type="submit" id="gif-start-btn" value="开始录制 GIF">
                            <input type="submit" id="gif-stop-btn" value="停止并导出 GIF">
                        </div>
                        <div class="control-block no-top-padding">
                            <div id="gif-status-box"></div>
                        </div>
                    </div>
                </div>

                <div id="manual-mode-section" style="display: none">
                    <div class="control-block no-top-padding">
                        <label><b>从数据库选择记录</b>
                            <select id="record-select-box">
                                <option value="">请选择记录</option>
                            </select>
                        </label>
                        <div class="manual-actions">
                            <input type="submit" id="refresh-records-btn" value="刷新列表">
                            <input type="submit" id="load-record-btn" value="加载记录">
                        </div>
                    </div>

                    <div class="control-block no-top-padding">
                        <div class="manual-tip">提示：输入任意方向都算正确（例如 1→5 与 5→1 均可）。</div>
                    </div>

                    <div class="control-block no-top-padding">
                        <div id="manual-remaining-box" class="manual-remaining"></div>
                        <div id="manual-steps-box" class="manual-steps"></div>
                        <input type="submit" id="manual-steps-toggle" value="展开全部" style="display: none">
                    </div>

                    <div class="control-block no-top-padding">
                        <label><b>起点编号</b><br>
                            <input type="number" id="manual-from-box" min="1" placeholder="例如：1">
                        </label>
                    </div>

                    <div class="control-block no-top-padding">
                        <label><b>终点编号</b><br>
                            <input type="number" id="manual-to-box" min="1" placeholder="例如：250">
                        </label>
                    </div>

                    <div class="control-block centered no-top-padding">
                        <input type="submit" id="manual-submit-btn" value="提交本步">
                    </div>

                    <div class="control-block no-top-padding centered">
                        <input type="submit" id="manual-restart-btn" value="重新开始复刻">
                        <input type="submit" id="manual-clear-btn" value="清空画布">
                        <input type="submit" id="manual-back-btn" value="返回选择记录">
                    </div>

                    <div class="control-block">
                        <div id="manual-status-box" class="manual-status"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="view">
            <canvas id="canvas"></canvas>
        </div>
    </div>

    <script src="js/constants.js"></script>
    <script src="https://unpkg.com/gif.js@0.2.0/dist/gif.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/string_art_generator.js"></script>
    <script src="js/init.js"></script>
    <script src="js/events.js"></script>
    <script src="js/draw.js"></script>
    <script>
        let canvas = document.getElementById('canvas')
        let generator = new StringArtGenerator(canvas)
    </script>
</body>
</html>
